{% extends "base_admin.html" %}

{% block head_additions %}
{{ block.super }}

<style>

@import "{{ media_url }}css/jquery-ui-1.8.6.custom.css";
@import "{{ media_url }}js/datatables/media/css/demo_table_jui.css";
@import "{{ media_url }}js/tabletools/css/TableTools.css";

</style>
<script type="text/javascript" src="{{ media_url }}js/jquery.js"></script>
<script type="text/javascript" src="{{ media_url }}js/jquery.uploadProgress.js"></script>
<script type="text/javascript" src="{{ media_url }}js/datatables/media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="{{ media_url }}js/tabletools/ZeroClipboard/ZeroClipboard.js"></script>
<script type="text/javascript" src="{{ media_url }}js/tabletools/js/TableTools.min.js"></script>
<script type="text/javascript" src="{{ media_url }}js/datatables/media/js/datatables.numhtml.js"></script>
<script language="javascript" type="text/javascript" src="{{ media_url }}js/flot/jquery.flot.js"></script>
<script language="javascript" type="text/javascript" src="{{ media_url }}js/flot/jquery.flot.selection.js"></script>
<script type="text/javascript" src="{{ media_url }}js/Apprise/apprise-1.5.js"></script>
<link rel="stylesheet" href="{{ media_url }}js/Apprise/apprise.css" type="text/css" />


<script type="text/javascript">

$(document).ready(function() {
	
	TableToolsInit.oFeatures.bXls = false;
    TableToolsInit.oFeatures.bCopy = false;
    TableToolsInit.oFeatures.bPrint = false;
	TableToolsInit.oFeatures.bCsv = false;
    TableToolsInit.oBom.bXls = false;
    TableToolsInit.iButtonHeight = 24;
    TableToolsInit.iButtonWidth = 24;
    TableToolsInit.sSwfPath = "/media/js/tabletools/swf/ZeroClipboard.swf";
    TableToolsInit.sTitle = "Students";
    
    var grades_table = $('#students_table').dataTable( {
        "bAutoWidth": false,
        "bJQueryUI": true,
        "bStateSave": true,
        "sScrollY": "325px",
        "bPaginate": false,
        "bLengthChange": false,
        "bScrollCollapse": true,
        "sDom": '<"H"T<"toolbar">>t',
		"oLanguage": {
			"sEmptyTable": "No students."
		}
    });

	$('.toolbar').html('<button id="upload_csv">Upload CSV of Students</button> <button id="add_student">Add Student</button>');
	$('.toolbar').attr('style', 'float:right');
	
	$('#add_student').click(function() {
		apprise('<h3>Add Student</h3>\
        <form id="add_student_form" action="/admin/sessions/{{ exam_group.name }}/edit/add_student/" method="post">\
        <div class="input_area">\
        <p><label for="">Last Name:</label> <input type="text" name="last_name"  id="add_student_name" maxlength="100" /></p>\
        <p><label for="">Student ID:</label> <input type="text" name="student_id" id="add_student_id" maxlength="100" /></p>\
        </div>\
        </form>', 
			{'confirm':true, 'textOk':'Add'},
			function(r) {
				if (r) {					
                    $('#add_student_form').submit();
				}
			}
		);
		return false;
	});
	
	
	$('#upload_csv').click(function() {		
		var str = '<h3>Upload CSV of Students</h3>\
			   <form id="upload_form" action="/admin/sessions/{{ exam_group.name }}/edit/csv/" method="post" enctype="multipart/form-data">\
			   <div class="input_area" id="upload_form">\
				<p><label for="">File:</label> <input id="" type="file" id="file" name="file" /></p>\
			   </div>\
			   <form>';

		apprise(str, {'confirm':true, 'textOk':'Upload'},
			function(r) {
				if (r) {
					$('#upload_form').submit();
				}
			}
		);
		
		return false;
	});
	
	$('#students_table td:first-child').attr('class', $('#students_table td:first-child').attr('class') + ' left_td');
});

</script>

{% endblock %}

{% block content_admin %}

<h1>Edit session</h1>


<h2>Basic settings</h2>

<form action="/admin/sessions/{{ exam_group.name }}/edit/" method="post">
	<div class="input_area">
		{{ form.as_p }}	
		
		<button>Save</button>
	</div>
	
	
</form>
	
<h2>Students</h2>

<table id="students_table" class="data_table display" cellspacing="0" cellpadding="0">
    <thead>
        <tr>
            <th>Last Name</th>
            <th>Student ID</th>
            <th>Retake</th>
        </tr>
    </thead>
    <tbody>
    	{% for student in all_students %}
      	    <tr class="grade_row" student_info="{{ student.student_id }}">
           		<td class="left">{{ student.user.last_name }}</td>
           		<td>{{ student.user.get_profile.student_id }}</td>
              	<td><a href="/admin/students/{{ student.student_id }}/retake/" class="allow_retake">Allow Retake</a></td>
           </tr>
   		{% endfor %}
    </tbody>
</table>


<h2>Problems</h2>

In the near future, you will be able to choose which problems this session will have, and you will be able to add new problems.
	
{% endblock %}
